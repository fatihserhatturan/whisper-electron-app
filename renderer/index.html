<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Whisper Transcriber</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary-orange: #ff8c42;
        --primary-orange-dark: #ff7420;
        --bg-light: #ffffff;
        --bg-light-secondary: #f8f9fa;
        --text-light: #2c3e50;
        --text-light-secondary: #6c757d;
        --border-light: #e0e0e0;
        --shadow-light: rgba(0, 0, 0, 0.1);

        --bg-dark: #1a1a2e;
        --bg-dark-secondary: #16213e;
        --text-dark: #eaeaea;
        --text-dark-secondary: #a0a0a0;
        --border-dark: #2d3748;
        --shadow-dark: rgba(0, 0, 0, 0.3);
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        transition: background-color 0.3s, color 0.3s;
      }

      body.light {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        color: var(--text-light);
      }

      body.dark {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        color: var(--text-dark);
      }

      .app-container {
        min-height: 100vh;
        padding: 20px;
      }

      /* Toolbar */
      .toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 24px;
        border-radius: 12px;
        margin-bottom: 24px;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 6px var(--shadow-light);
      }

      body.light .toolbar {
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid var(--border-light);
      }

      body.dark .toolbar {
        background: rgba(22, 33, 62, 0.9);
        border: 1px solid var(--border-dark);
        box-shadow: 0 4px 6px var(--shadow-dark);
      }

      .toolbar-left {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .app-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--primary-orange);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .toolbar-right {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      /* Switch Button */
      .switch-container {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .switch {
        position: relative;
        width: 50px;
        height: 26px;
        cursor: pointer;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.3s;
        border-radius: 26px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.3s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: var(--primary-orange);
      }

      input:checked + .slider:before {
        transform: translateX(24px);
      }

      .switch-icon {
        font-size: 18px;
      }

      /* Main Content */
      .main-content {
        max-width: 1000px;
        margin: 0 auto;
      }

      .card {
        padding: 32px;
        border-radius: 16px;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 16px var(--shadow-light);
        margin-bottom: 24px;
      }

      body.light .card {
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid var(--border-light);
      }

      body.dark .card {
        background: rgba(22, 33, 62, 0.95);
        border: 1px solid var(--border-dark);
        box-shadow: 0 8px 16px var(--shadow-dark);
      }

      .file-selector {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-bottom: 24px;
      }

      .file-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 14px 28px;
        border: 2px dashed var(--border-light);
        border-radius: 12px;
        background: transparent;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        transition: all 0.3s;
      }

      body.light .file-button {
        color: var(--text-light);
        border-color: var(--border-light);
      }

      body.dark .file-button {
        color: var(--text-dark);
        border-color: var(--border-dark);
      }

      .file-button:hover:not(:disabled) {
        border-color: var(--primary-orange);
        color: var(--primary-orange);
        transform: translateY(-2px);
      }

      .file-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .file-info {
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      body.light .file-info {
        background: var(--bg-light-secondary);
        color: var(--text-light-secondary);
      }

      body.dark .file-info {
        background: var(--bg-dark-secondary);
        color: var(--text-dark-secondary);
      }

      .action-buttons {
        display: flex;
        gap: 12px;
        margin-bottom: 24px;
      }

      .action-button {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 16px 24px;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 8px var(--shadow-light);
      }

      .action-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
      }

      .action-button.primary {
        background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%);
        color: white;
      }

      .action-button.primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px var(--shadow-light);
      }

      .action-button.danger {
        background: #e74c3c;
        color: white;
      }

      .action-button.danger:hover:not(:disabled) {
        background: #c0392b;
        transform: translateY(-2px);
      }

      .output-section {
        margin-top: 24px;
      }

      .output-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 16px;
        font-size: 18px;
        font-weight: 600;
        color: var(--primary-orange);
      }

      .output-box {
        padding: 20px;
        border-radius: 12px;
        font-family: 'Consolas', 'Monaco', monospace;
        font-size: 14px;
        line-height: 1.6;
        white-space: pre-wrap;
        word-wrap: break-word;
        max-height: 400px;
        overflow-y: auto;
        min-height: 200px;
      }

      body.light .output-box {
        background: var(--bg-light-secondary);
        color: var(--text-light);
        border: 1px solid var(--border-light);
      }

      body.dark .output-box {
        background: var(--bg-dark-secondary);
        color: var(--text-dark);
        border: 1px solid var(--border-dark);
      }

      .output-box::-webkit-scrollbar {
        width: 8px;
      }

      .output-box::-webkit-scrollbar-track {
        background: transparent;
      }

      .output-box::-webkit-scrollbar-thumb {
        background: var(--primary-orange);
        border-radius: 4px;
      }

      /* Progress Bar */
      .progress-container {
        margin: 16px 0;
        display: none;
      }

      .progress-container.active {
        display: block;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        border-radius: 8px;
        overflow: hidden;
        position: relative;
      }

      body.light .progress-bar {
        background: var(--bg-light-secondary);
      }

      body.dark .progress-bar {
        background: var(--bg-dark-secondary);
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-orange) 0%, var(--primary-orange-dark) 100%);
        transition: width 0.3s ease;
        border-radius: 8px;
        position: relative;
        overflow: hidden;
      }

      .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }

      .progress-text {
        text-align: center;
        margin-top: 8px;
        font-size: 14px;
        font-weight: 600;
        color: var(--primary-orange);
      }

      .empty-state {
        text-align: center;
        padding: 40px;
        opacity: 0.5;
      }

      /* Icons */
      .icon {
        width: 20px;
        height: 20px;
        display: inline-block;
      }

      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }

      .spinning {
        animation: spin 1s linear infinite;
      }
    </style>
  </head>
  <body class="light">
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <script>
      const { useState, useEffect, useRef } = React;

      // Translations
      const translations = {
        tr: {
          appTitle: 'Whisper Transkripsiyon',
          selectFile: 'Ses Dosyası Seç',
          transcribe: 'Transkribe Et',
          transcribing: 'İşleniyor...',
          stop: 'Durdur',
          output: 'Çıktı',
          noFile: 'Henüz dosya seçilmedi',
          emptyOutput: 'Transkripsiyon çıktısı burada görünecek',
          selectFileFirst: 'Lütfen bir ses dosyası seçin.',
          error: 'Hata',
          unknownError: 'Bilinmeyen hata',
          unexpectedError: 'Beklenmeyen hata',
          processStopped: 'İşlem sonlandı',
          processCompleted: 'İşlem tamamlandı',
          stoppedByUser: 'İşlem kullanıcı tarafından durduruldu',
          noProcessToStop: 'Duracak bir işlem bulunamadı'
        },
        en: {
          appTitle: 'Whisper Transcription',
          selectFile: 'Select Audio File',
          transcribe: 'Transcribe',
          transcribing: 'Processing...',
          stop: 'Stop',
          output: 'Output',
          noFile: 'No file selected yet',
          emptyOutput: 'Transcription output will appear here',
          selectFileFirst: 'Please select an audio file.',
          error: 'Error',
          unknownError: 'Unknown error',
          unexpectedError: 'Unexpected error',
          processStopped: 'Process terminated',
          processCompleted: 'Process completed',
          stoppedByUser: 'Process stopped by user',
          noProcessToStop: 'No process to stop'
        }
      };

      // Icons as SVG
      const Icons = {
        Sun: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
          React.createElement('circle', { cx: '12', cy: '12', r: '5' }),
          React.createElement('line', { x1: '12', y1: '1', x2: '12', y2: '3' }),
          React.createElement('line', { x1: '12', y1: '21', x2: '12', y2: '23' }),
          React.createElement('line', { x1: '4.22', y1: '4.22', x2: '5.64', y2: '5.64' }),
          React.createElement('line', { x1: '18.36', y1: '18.36', x2: '19.78', y2: '19.78' }),
          React.createElement('line', { x1: '1', y1: '12', x2: '3', y2: '12' }),
          React.createElement('line', { x1: '21', y1: '12', x2: '23', y2: '12' }),
          React.createElement('line', { x1: '4.22', y1: '19.78', x2: '5.64', y2: '18.36' }),
          React.createElement('line', { x1: '18.36', y1: '5.64', x2: '19.78', y2: '4.22' })
        ),
        Moon: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
          React.createElement('path', { d: 'M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z' })
        ),
        Globe: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
          React.createElement('circle', { cx: '12', cy: '12', r: '10' }),
          React.createElement('line', { x1: '2', y1: '12', x2: '22', y2: '12' }),
          React.createElement('path', { d: 'M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z' })
        ),
        Mic: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
          React.createElement('path', { d: 'M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z' }),
          React.createElement('path', { d: 'M19 10v2a7 7 0 0 1-14 0v-2' }),
          React.createElement('line', { x1: '12', y1: '19', x2: '12', y2: '23' }),
          React.createElement('line', { x1: '8', y1: '23', x2: '16', y2: '23' })
        ),
        Upload: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
          React.createElement('path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4' }),
          React.createElement('polyline', { points: '17 8 12 3 7 8' }),
          React.createElement('line', { x1: '12', y1: '3', x2: '12', y2: '15' })
        ),
        Play: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
          React.createElement('polygon', { points: '5 3 19 12 5 21 5 3' })
        ),
        Stop: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
          React.createElement('rect', { x: '6', y: '6', width: '12', height: '12', rx: '2' })
        ),
        File: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
          React.createElement('path', { d: 'M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z' }),
          React.createElement('polyline', { points: '13 2 13 9 20 9' })
        ),
        Loader: () => React.createElement('svg', { className: 'icon spinning', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
          React.createElement('line', { x1: '12', y1: '2', x2: '12', y2: '6' }),
          React.createElement('line', { x1: '12', y1: '18', x2: '12', y2: '22' }),
          React.createElement('line', { x1: '4.93', y1: '4.93', x2: '7.76', y2: '7.76' }),
          React.createElement('line', { x1: '16.24', y1: '16.24', x2: '19.07', y2: '19.07' }),
          React.createElement('line', { x1: '2', y1: '12', x2: '6', y2: '12' }),
          React.createElement('line', { x1: '18', y1: '12', x2: '22', y2: '12' }),
          React.createElement('line', { x1: '4.93', y1: '19.07', x2: '7.76', y2: '16.24' }),
          React.createElement('line', { x1: '16.24', y1: '7.76', x2: '19.07', y2: '4.93' })
        ),
        FileText: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
          React.createElement('path', { d: 'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z' }),
          React.createElement('polyline', { points: '14 2 14 8 20 8' }),
          React.createElement('line', { x1: '16', y1: '13', x2: '8', y2: '13' }),
          React.createElement('line', { x1: '16', y1: '17', x2: '8', y2: '17' }),
          React.createElement('polyline', { points: '10 9 9 9 8 9' })
        )
      };

      function App() {
        const [theme, setTheme] = useState('light');
        const [language, setLanguage] = useState('tr');
        const [file, setFile] = useState(null);
        const [text, setText] = useState('');
        const [busy, setBusy] = useState(false);
        const [progress, setProgress] = useState(0);
        const [audioDuration, setAudioDuration] = useState(0);
        const textRef = useRef('');

        const t = translations[language];

        useEffect(() => {
          document.body.className = theme;
        }, [theme]);

        useEffect(() => {
          window.electronAPI.onTranscriptChunk((chunk) => {
            // Timestamp'leri temizle (format: [00:00:00.000 --> 00:00:00.000])
            const cleanChunk = chunk.replace(/\[\d{2}:\d{2}:\d{2}\.\d{3}\s*-->\s*\d{2}:\d{2}:\d{2}\.\d{3}\]\s*/g, '');

            if (cleanChunk.trim()) {
              textRef.current += cleanChunk;
              setText(textRef.current);
            }
          });

          window.electronAPI.onTranscriptStderr((chunk) => {
            // stderr'den ilerleme bilgisini çıkar
            // Format: "whisper_full_with_state: progress = 45%"
            const progressMatch = chunk.match(/progress\s*=\s*(\d+)%/);
            if (progressMatch) {
              const percent = parseInt(progressMatch[1]);
              setProgress(percent);
            }

            // console'a yaz
            console.log('whisper process info:', chunk);
          });

          window.electronAPI.onTranscriptEnd((info) => {
            setBusy(false);
            setProgress(0);
            // Hiçbir durum mesajı ekleme, sadece busy state'i güncelle
          });
        }, [language]);

        async function pickFile() {
          const p = await window.electronAPI.openFile();
          if (p) {
            setFile(p);
            setText('');
            textRef.current = '';
          }
        }

        async function transcribe() {
          if (!file) return alert(t.selectFileFirst);
          setBusy(true);
          setText('');
          setProgress(0);
          textRef.current = '';
          try {
            // Promise sadece hata durumunda kullanılacak
            // Normal akış transcript-chunk ve transcript-end ile yönetiliyor
            await window.electronAPI.transcribeFile(file);
          } catch (err) {
            setBusy(false);
            setProgress(0);
            alert(t.unexpectedError + ': ' + err);
          }
        }

        async function stop() {
          await window.electronAPI.stopTranscription();
          setBusy(false);
          setProgress(0);
          // Hiçbir mesaj ekleme, sadece durdur
        }

        return React.createElement('div', { className: 'app-container' },
          // Toolbar
          React.createElement('div', { className: 'toolbar' },
            React.createElement('div', { className: 'toolbar-left' },
              React.createElement('div', { className: 'app-title' },
                React.createElement(Icons.Mic),
                t.appTitle
              )
            ),
            React.createElement('div', { className: 'toolbar-right' },
              // Language Switch
              React.createElement('div', { className: 'switch-container' },
                React.createElement('span', { className: 'switch-icon' }, '🇹🇷'),
                React.createElement('label', { className: 'switch' },
                  React.createElement('input', {
                    type: 'checkbox',
                    checked: language === 'en',
                    onChange: (e) => setLanguage(e.target.checked ? 'en' : 'tr')
                  }),
                  React.createElement('span', { className: 'slider' })
                ),
                React.createElement('span', { className: 'switch-icon' }, '🇬🇧')
              ),
              // Theme Switch
              React.createElement('div', { className: 'switch-container' },
                React.createElement(Icons.Sun),
                React.createElement('label', { className: 'switch' },
                  React.createElement('input', {
                    type: 'checkbox',
                    checked: theme === 'dark',
                    onChange: (e) => setTheme(e.target.checked ? 'dark' : 'light')
                  }),
                  React.createElement('span', { className: 'slider' })
                ),
                React.createElement(Icons.Moon)
              )
            )
          ),

          // Main Content
          React.createElement('div', { className: 'main-content' },
            React.createElement('div', { className: 'card' },
              // File Selector
              React.createElement('div', { className: 'file-selector' },
                React.createElement('button', {
                  className: 'file-button',
                  onClick: pickFile,
                  disabled: busy
                },
                  React.createElement(Icons.Upload),
                  t.selectFile
                ),
                file && React.createElement('div', { className: 'file-info' },
                  React.createElement(Icons.File),
                  file
                )
              ),

              // Action Buttons
              React.createElement('div', { className: 'action-buttons' },
                React.createElement('button', {
                  className: 'action-button primary',
                  onClick: transcribe,
                  disabled: busy || !file
                },
                  busy ? React.createElement(Icons.Loader) : React.createElement(Icons.Play),
                  busy ? t.transcribing : t.transcribe
                ),
                React.createElement('button', {
                  className: 'action-button danger',
                  onClick: stop,
                  disabled: !busy
                },
                  React.createElement(Icons.Stop),
                  t.stop
                )
              ),

              // Progress Bar
              React.createElement('div', { className: 'progress-container' + (busy ? ' active' : '') },
                React.createElement('div', { className: 'progress-bar' },
                  React.createElement('div', {
                    className: 'progress-fill',
                    style: { width: progress + '%' }
                  })
                ),
                React.createElement('div', { className: 'progress-text' },
                  progress > 0 ? progress + '%' : t.transcribing + '...'
                )
              ),

              // Output Section
              React.createElement('div', { className: 'output-section' },
                React.createElement('div', { className: 'output-header' },
                  React.createElement(Icons.FileText),
                  t.output
                ),
                React.createElement('div', { className: 'output-box' },
                  text || React.createElement('div', { className: 'empty-state' }, t.emptyOutput)
                )
              )
            )
          )
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
  </body>
</html>
